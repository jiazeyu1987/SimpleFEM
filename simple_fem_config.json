{
  "_comment": "SimpleFEM 配置文件：此 JSON 不支持真正的注释，所以用 _comment 字段说明配置含义；程序会忽略未知字段。",
  "processing_mode": "video",
  "data_processing": {
    "_comment": "数据保存/日志策略（only_delect=true 表示只有检测到波峰才保存/记录）。",
    "save_roi1": true,
    "save_roi2": true,
    "save_wave": true,
    "only_delect": false
  },
  "video_processing": {
    "_comment": "processing_mode=video 时生效：从本地视频读取帧作为输入。",
    "video_path": "123.mp4",
    "loop_enabled": false,
    "processing_frame_rate": 10.0
  },
  "roi_capture": {
    "_comment": "ROI1/ROI2 截图参数：ROI1 是大区域，ROI2 是围绕绿色交点的局部区域。",
    "frame_rate": 10,
    "default_config": {
      "_comment": "ROI1 在屏幕/视频帧中的矩形坐标（x1,y1 左上；x2,y2 右下）。",
      "x1": 1280,
      "y1": 80,
      "x2": 1920,
      "y2": 980
    },
    "roi2_config": {
      "_comment": "ROI2 从 ROI1 中裁剪：以绿色交点为中心，按 extension_params 扩展得到 ROI2。",
      "extension_params": {
        "_comment": "ROI2 扩展像素：left/right/top/bottom 表示相对交点向四个方向扩展的像素数。",
        "left": 20,
        "right": 30,
        "top": 60,
        "bottom": 20
      }
    }
  },
  "peak_detection": {
    "_comment": "波峰检测：先用阈值识别连续高位区间（波峰），再用 pre/post 均值差判定绿/红；支持自适应阈值（基于背景均值）。",
    "threshold": 95.0,
    "_comment_threshold": "固定阈值：自适应阈值未启用或历史样本不足时，使用该阈值判定“灰度>=阈值”为高位。",
    "margin_frames": 5,
    "_comment_margin_frames": "峰间最小间隔：两个波峰间隔小于该值时只保留峰值更高的那个。",
    "silence_frames": 5,
    "_comment_silence_frames": "干净区间长度 X：波峰升上阈值前 X 帧、降回阈值后 X 帧都必须 < 阈值，否则不算波峰（会增加确认延迟）。",
    "pre_post_avg_frames": 5,
    "_comment_pre_post_avg_frames": "用于计算 pre_peak_avg/post_peak_avg 的窗口帧数 N（绿/红判定也基于同一个 N）。",
    "adaptive_threshold_enabled": true,
    "_comment_adaptive_threshold_enabled": "是否启用自适应阈值：阈值=背景均值*(1+threshold_over_mean_ratio)；背景均值采用“低于阈值才更新”的门控均值，避免被波峰污染。",
    "threshold_over_mean_ratio": 0.15,
    "_comment_threshold_over_mean_ratio": "自适应阈值上浮比例：0.15 表示比背景均值高 15%。",
    "history_mean_min_samples": 30,
    "_comment_history_mean_min_samples": "自适应阈值生效前需要的最少历史样本数（背景均值更新次数）。",
    "difference_threshold": 2.1,
    "_comment_difference_threshold": "绿/红判定阈值 X：若 (post_peak_avg - pre_peak_avg) >= X 判为绿色，否则判为红色。",
    "min_region_length": 5,
    "_comment_min_region_length": "最小波峰宽度：波峰区间长度小于该值会被过滤（单位：帧）。",
    "use_improved_algorithm": false,
    "_comment_use_improved_algorithm": "是否启用外部 improved_peak_detection 模块（如果存在）；当前默认走内置阈值+规则版本。",
    "preprocessing": {
      "_comment": "预处理参数（目前主流程未使用，预留）。",
      "noise_reduction_factor": 0.8,
      "baseline_correction": true,
      "smoothing_window": 5
    },
    "detection": {
      "_comment": "形态/宽度类检测参数（目前主流程未使用，预留）。",
      "min_peak_width": 3,
      "max_peak_width": 20,
      "min_peak_distance": 10,
      "prominence_factor": 0.1
    },
    "classification": {
      "_comment": "更复杂的分类/稳定性参数（目前主流程未使用，预留）。",
      "stability_window": 5,
      "error_tolerance": 0.15,
      "min_green_prominence": 0.3,
      "red_detection_variance": 0.4
    },
    "tracking": {
      "_comment": "生命周期追踪参数（目前主流程未使用，预留）。",
      "enable_lifecycle_tracking": true,
      "peak_matching_threshold": 0.8,
      "max_tracking_age": 15
    }
  },
  "deduplication": {
    "_comment": "统计导出去重参数（safe_peak_statistics.py 使用）：避免短时间内重复记录相似波峰。",
    "consecutive_frame_window": 10,
    "_comment_consecutive_frame_window": "连续同色去重窗口：同色波峰在该窗口内只保留更高的一个。",
    "consecutive_deduplication_enabled": true
  }
}
